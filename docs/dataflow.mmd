%%{init: {'theme': 'base', 'themeVariables': {'actorBkg': '#0891B2', 'actorTextColor': '#FFFFFF', 'actorBorder': '#0891B2', 'actorLineColor': '#1E3A5F', 'signalColor': '#1E3A5F', 'signalTextColor': '#1E3A5F', 'labelBoxBkgColor': '#F97316', 'labelBoxBorderColor': '#F97316', 'labelTextColor': '#FFFFFF', 'loopTextColor': '#1E3A5F', 'noteBkgColor': '#FEF3C7', 'noteTextColor': '#1E3A5F', 'noteBorderColor': '#F5A623', 'activationBkgColor': '#E0F2FE', 'activationBorderColor': '#0891B2', 'sequenceNumberColor': '#FFFFFF', 'background': '#FFFFFF', 'mainBkg': '#FFFFFF', 'lineColor': '#1E3A5F'}, 'sequence': {'mirrorActors': false, 'messageAlign': 'center', 'messageFontSize': 13, 'actorFontSize': 14, 'noteFontSize': 13, 'wrap': true, 'width': 180}}}%%
sequenceDiagram
    actor User
    participant FE as Frontend (React)
    participant API as FastAPI Server
    participant GC as GroupChat Orchestrator
    participant CR as Creator (CoT)
    participant RV as Reviewer (ReAct)
    participant PB as Publisher (Self-Reflection)
    participant AOAI as Azure OpenAI (GPT-4.1)
    participant MCP as MCP Filesystem

    User->>FE: Fill campaign brief & click Generate
    FE->>API: POST /api/generate
    API->>API: Load brand guidelines into Creator instructions

    API->>GC: workflow.run(brief, stream=True)

    Note over GC: Round 1 - Creator

    GC->>CR: Generate draft
    CR->>AOAI: Chat Completions
    AOAI-->>CR: 5-step reasoning + draft
    CR-->>GC: Draft content

    Note over GC: Round 2 - Reviewer

    GC->>RV: Review draft
    RV->>AOAI: Evaluate with ReAct
    AOAI-->>RV: Observation/Thought/Action/Result

    alt REVISE
        RV-->>GC: REVISE + feedback
        GC->>CR: Revise draft
        CR->>AOAI: Apply feedback
        AOAI-->>CR: Revised draft
        CR-->>GC: Updated content
        GC->>RV: Re-review
        RV-->>GC: APPROVED
    else APPROVED
        RV-->>GC: APPROVED
    end

    Note over GC: Publisher formats

    GC->>PB: Format for platforms
    PB->>AOAI: Generate LinkedIn + Twitter + Instagram
    AOAI-->>PB: 3 platform posts + reflection checks
    PB->>MCP: Save to output/*.md
    PB-->>GC: All posts validated

    Note over GC: Termination - Publisher spoke

    GC-->>API: WorkflowRunResult
    API->>API: Parse platform posts
    API-->>FE: JSON response
    FE-->>User: Display posts + transcript
